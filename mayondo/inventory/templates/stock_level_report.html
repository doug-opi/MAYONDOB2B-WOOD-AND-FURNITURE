{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-3 text-center">ðŸ“¦ Stock Level Report</h2>

  <div class="row text-center mb-4">
    <div class="col-md-3">
      <div class="card bg-success text-white shadow">
        <div class="card-body">
          <h5>Available</h5>
          <h3>{{ available_count }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-dark shadow">
        <div class="card-body">
          <h5>Low Stock (â‰¤5)</h5>
          <h3>{{ low_stock_count }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-danger text-white shadow">
        <div class="card-body">
          <h5>Out of Stock</h5>
          <h3>{{ out_of_stock_count }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-primary text-white shadow">
        <div class="card-body">
          <h5>Total Stock Value</h5>
          <h3>{{ total_stock_value|intcomma }} UGX</h3>
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-end mb-3">
    <a href="{% url 'download_stock_report' %}" class="btn btn-outline-danger">
      <i class="bi bi-file-earmark-pdf"></i> Download PDF Report
    </a>
  </div>

  <table class="table table-hover table-bordered">
    <thead class="table-dark">
      <tr>
        <th>Product</th>
        <th>Category</th>
        <th>Quantity</th>
        <th>Unit Price (UGX)</th>
        <th>Total Value (UGX)</th>
      </tr>
    </thead>
    <tbody>
      {% for product in products %}
      <tr class="
          {% if product.quantity == 0 %}
            table-danger
          {% elif product.quantity <= 5 %}
            table-warning
          {% else %}
            table-success
          {% endif %}
        ">
        <td>{{ product.name }}</td>
        <td>{{ product.category.name }}</td>
        <td>{{ product.quantity }}</td>
        <td>{{ product.unit_price|intcomma }}</td>
        <td>{{ product.stock_value|intcomma }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="text-center">No products found.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  {% if is_paginated %}
  <div class="pagination justify-content-center">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-outline-secondary btn-sm">Previous</a>
    {% endif %}
    <span class="mx-2">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}" class="btn btn-outline-secondary btn-sm">Next</a>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}
